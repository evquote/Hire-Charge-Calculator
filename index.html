<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Venue Booking Quote Calculator</title>
<style>
  body { font-family: Arial, sans-serif; margin: 40px; background: #f5f6fa; color: #333; }
  h1 { text-align: center; }
  label { display: block; margin-top: 10px; font-weight: bold; }
  select, input { padding: 5px; margin-top: 4px; width: 200px; }
  button { margin-top: 15px; padding: 8px 15px; background: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
  button:hover { background: #0056b3; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background: #007bff; color: #fff; }
  .after-hours { color: #d9534f; font-weight: bold; }
  .note { font-size: 0.9em; color: #777; margin-top: 5px; }
</style>
</head>
<body>

<h1>Venue Booking Quote Calculator</h1>

<form id="quoteForm">
  <div id="time-section">
    <label>Booking Start Time</label>
    <select id="startTime"></select>

    <label>Booking End Time</label>
    <select id="endTime"></select>
    <p class="note">Minimum booking duration: 4 hours</p>
  </div>

  <label>Venue</label>
  <select id="venue">
    <option value="Main Hall">Main Hall</option>
    <option value="Conference Room">Conference Room</option>
    <option value="Outdoor Space">Outdoor Space</option>
  </select>

  <label>Hire Type</label>
  <select id="hireType">
    <option value="Standard">Standard</option>
    <option value="Premium">Premium</option>
  </select>

  <label>Equipment Add-ons (£)</label>
  <input type="number" id="addons" value="0" min="0" step="1">

  <button type="button" id="addItem">Add to Quote</button>
</form>

<table id="orderTable">
  <thead>
    <tr>
      <th>Venue</th>
      <th>Hire Type</th>
      <th>Hours</th>
      <th>Base (£)</th>
      <th>Equipment (£)</th>
      <th>Subtotal (£)</th>
      <th>VAT (£)</th>
      <th>Total (£)</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h3 class="after-hours">After-Hours Surcharge: <span id="afterHoursTotal">£0.00</span></h3>
<h2>Grand Total: <span id="grandTotal">£0.00</span></h2>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const startSelect = document.getElementById('startTime');
  const endSelect = document.getElementById('endTime');

  // Populate time dropdowns
  function populateTimeDropdowns() {
    for (let h = 0; h < 24; h++) {
      for (let m = 0; m < 60; m += 30) {
        const val = ('0' + h).slice(-2) + ':' + ('0' + m).slice(-2);
        const opt1 = document.createElement('option');
        const opt2 = document.createElement('option');
        opt1.value = opt2.value = val;
        opt1.textContent = opt2.textContent = val;
        startSelect.appendChild(opt1);
        endSelect.appendChild(opt2);
      }
    }
    startSelect.value = '09:00';
    endSelect.value = '13:00';
  }
  populateTimeDropdowns();

  // Ensure end time is always after start time
  startSelect.addEventListener('change', () => {
    const startIndex = startSelect.selectedIndex;
    for (let i = 0; i < endSelect.options.length; i++) {
      endSelect.options[i].disabled = i <= startIndex + 7 ? false : false; // maintain all, we'll validate later
    }
    validateMinimumHours();
  });

  endSelect.addEventListener('change', validateMinimumHours);

  function validateMinimumHours() {
    const hours = calculateHours();
    if (hours < 4) {
      alert('Minimum booking is 4 hours. Please adjust your times.');
      endSelect.value = startSelect.options[startSelect.selectedIndex + 8]?.value || startSelect.value;
    }
  }

  // Calculate total hours between start & end time
  function calculateHours() {
    const [sh, sm] = startSelect.value.split(':').map(Number);
    const [eh, em] = endSelect.value.split(':').map(Number);
    let start = sh + sm / 60;
    let end = eh + em / 60;
    if (end <= start) end += 24; // handle overnight bookings
    return end - start;
  }

  // Base hourly rates by venue and type
  const baseRates = {
    'Main Hall': { Standard: 100, Premium: 150 },
    'Conference Room': { Standard: 80, Premium: 120 },
    'Outdoor Space': { Standard: 60, Premium: 90 }
  };

  const order = [];

  document.getElementById('addItem').addEventListener('click', () => {
    const venue = document.getElementById('venue').value;
    const hireType = document.getElementById('hireType').value;
    const addons = parseFloat(document.getElementById('addons').value) || 0;

    const hours = calculateHours();
    if (hours < 4) {
      alert('Minimum booking is 4 hours.');
      return;
    }

    const baseRate = baseRates[venue][hireType];
    const base = baseRate * hours;
    const subtotal = base + addons;
    const vat = subtotal * 0.2;
    const total = subtotal + vat;

    order.push({ venue, hireType, hours, base, addons, subtotal, vat, total });
    updateTable();
  });

  function updateTable() {
    const tbody = document.querySelector('#orderTable tbody');
    tbody.innerHTML = '';
    order.forEach((item, i) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${item.venue}</td>
        <td>${item.hireType}</td>
        <td>${item.hours.toFixed(1)}</td>
        <td>£${item.base.toFixed(2)}</td>
        <td>£${item.addons.toFixed(2)}</td>
        <td>£${item.subtotal.toFixed(2)}</td>
        <td>£${item.vat.toFixed(2)}</td>
        <td>£${item.total.toFixed(2)}</td>
        <td><button onclick="removeItem(${i})">Remove</button></td>
      `;
      tbody.appendChild(row);
    });
    updateTotals();
  }

  window.removeItem = (index) => {
    order.splice(index, 1);
    updateTable();
  };

  function calculateAfterHours() {
    const [sh] = startSelect.value.split(':').map(Number);
    const [eh] = endSelect.value.split(':').map(Number);
    const afterHours = (sh < 9 ? 9 - sh : 0) + (eh > 23 ? eh - 23 : 0);
    const rate = 25; // flat after-hours surcharge per hour
    return afterHours * rate;
  }

  function updateTotals() {
    const afterHoursTotal = calculateAfterHours();
    const total = order.reduce((sum, i) => sum + i.total, 0) + afterHoursTotal;
    document.getElementById('afterHoursTotal').textContent = `£${afterHoursTotal.toFixed(2)}`;
    document.getElementById('grandTotal').textContent = `£${total.toFixed(2)}`;
  }
});
</script>

</body>
</html>
