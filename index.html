<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Royal Birmingham Conservatoire — Multi-Venue Quote Calculator</title>
<style>
:root{
  --brand:#002e5b;
  --muted:#6b6b6b;
  --bg:#fafafa;
  --card:#ffffff;
}
*{box-sizing:border-box}
body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#222;margin:0;padding:20px;display:flex;justify-content:center;}
.wrapper{max-width:1000px;width:100%;}
header{display:flex;align-items:center;gap:16px;margin-bottom:18px;justify-content:space-between;flex-wrap:wrap;}
h1{font-size:20px;margin:0;color:var(--brand);}
nav{display:flex;gap:10px;align-items:center;}
nav button, nav a.button{background:var(--brand);color:white;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;text-decoration:none;}
.card{background:var(--card);padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(8,24,40,0.06);margin-bottom:14px;}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
label{display:block;font-size:13px;margin-bottom:6px;}
select,input[type=number]{width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;box-sizing:border-box;}
.full{grid-column:1/-1;}
fieldset{border:1px solid #eee;padding:10px;border-radius:8px;margin:0;}
.checkbox-row{display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid #fafafa;}
.qty{width:86px;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th, td{border:1px solid #ddd;padding:8px;text-align:center;}
th{background:var(--brand);color:white;}
#grandTotal, #staffGrandTotal{font-weight:700;font-size:18px;color:var(--brand);text-align:right;margin-top:10px;}
button.mainBtn{background:var(--brand);color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;margin-right:6px;}
.muted{color:var(--muted);font-size:13px;}
input[type=text]{width:100%;padding:6px;border:1px solid #ccc;border-radius:6px;box-sizing:border-box;}
.hidden{display:none;}

/* ===== Gallery styles ===== */
.gallery{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:14px;margin-bottom:20px;}
.panel{position:relative;cursor:pointer;border-radius:8px;overflow:hidden;box-shadow:0 3px 8px rgba(0,0,0,0.06);transition:transform .22s ease,box-shadow .22s ease;}
.panel:hover{transform:translateY(-6px) scale(1.03);box-shadow:0 12px 30px rgba(0,0,0,0.15);}
.panel img{width:100%;height:120px;object-fit:cover;display:block;filter:contrast(1);}
.panel .title{
  position:absolute;left:0;right:0;bottom:0;
  background:linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,46,91,0.88) 100%);
  color:white;text-align:left;padding:10px 12px;font-size:14px;font-weight:700;
  text-shadow:0 1px 3px rgba(0,0,0,0.5);
  display:flex;flex-direction:column;
}
.panel .title .venue-name{font-weight:700;}
.panel .title .venue-sub{font-weight:400;font-size:12px;opacity:0.9;margin-top:2px}

/* ===== Modal styles ===== */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.75);justify-content:center;align-items:center;z-index:9999;padding:20px;}
.modal-content{background:white;max-width:920px;width:100%;padding:18px;border-radius:8px;position:relative;box-shadow:0 20px 60px rgba(0,0,0,0.4);display:flex;flex-direction:column;gap:12px;}
.modal-media{position:relative;}
.modal-content img{width:100%;height:auto;border-radius:6px;cursor:pointer;display:block;}
.modal-caption{display:flex;justify-content:space-between;align-items:center;gap:10px;}
.modal-desc{color:#222;font-size:14px;line-height:1.45;max-height:220px;overflow:auto;padding-top:6px;}
.modal-close{position:absolute;top:12px;right:12px;background:var(--brand);color:white;border:none;padding:6px 10px;border-radius:4px;cursor:pointer;}
.modal-prev, .modal-next{
  position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,46,91,0.9);color:#fff;border:none;padding:10px 12px;border-radius:6px;cursor:pointer;font-size:18px;
}
.modal-prev{left:8px}
.modal-next{right:8px}
.modal-hint{font-size:12px;color:#666;text-align:center;margin-top:6px;}

/* responsive */
@media (max-width:820px){
  .modal-content{max-width:760px}
}
@media (max-width:520px){
  .panel img{height:100px}
  .modal-prev, .modal-next{padding:8px;font-size:16px}
}
</style>
</head>
<body>
<div class="wrapper">

<header>
  <div>
    <h1>Royal Birmingham Conservatoire — Multi-Venue Quote</h1>
    <div class="muted">Add multiple venues to generate a combined quote. All prices + VAT.</div>
  </div>
  <nav>
    <button id="venueTab">Venue Quote</button>
    <button id="staffTab">Staffing Costs</button>
    <a href="#" class="button" id="clearSession" style="display:none;">Logout Staffing</a>
  </nav>
</header>

<!-- GALLERY -->
<div class="gallery" id="venueGallery">
  <!-- Panels - images replaced by your data below via JS, but include fallback markup for quick view -->
  <div class="panel" data-venue="Bradshaw">
    <img src="https://www.tagvenue.com/resize/98/a1/widen-1680-noupsize;68138-bradshaw-hall-room-enhanced-v1-3027435.jpg" alt="Bradshaw Hall">
    <div class="title"><span class="venue-name">Bradshaw Hall</span><span class="venue-sub">Large concert hall</span></div>
  </div>
  <div class="panel" data-venue="Recital">
    <img src="https://azure.wgp-cdn.co.uk/app-pianist/posts/Royal-Birmingham-Conservatoire_Charcoalblue_credit-Hufton-and-Crow_lowres-023.jpg?&width=1200&height=630&mode=crop" alt="Recital Hall">
    <div class="title"><span class="venue-name">Recital Hall</span><span class="venue-sub">Intimate recital space</span></div>
  </div>
  <div class="panel" data-venue="Jazz">
    <img src="https://img.bcu.ac.uk/_bcuimages/tom-bird-birmingham-conservatoire-25-131600600782377259.jpg" alt="Eastside Jazz Club">
    <div class="title"><span class="venue-name">Eastside Jazz Club</span><span class="venue-sub">Jazz & small gigs</span></div>
  </div>
  <div class="panel" data-venue="Organ">
    <img src="https://img.bcu.ac.uk/_bcuimages/copyright-hufton-crow-30-131600603623200315.jpg" alt="Organ Studio">
    <div class="title"><span class="venue-name">Organ Studio</span><span class="venue-sub">Chamber & organ</span></div>
  </div>
  <div class="panel" data-venue="Lab">
    <img src="https://img.bcu.ac.uk/_bcuimages/tom-bird-birmingham-conservatoire-8-131600601961613750.jpg" alt="The Lab">
    <div class="title"><span class="venue-name">The Lab</span><span class="venue-sub">Black-box studio</span></div>
  </div>
  <div class="panel" data-venue="Workshop">
    <img src="https://img.bcu.ac.uk/_bcuimages/copyright-hufton-crow-2-131600605710728764.jpg" alt="Workshops">
    <div class="title"><span class="venue-name">Workshops / Performance Studios</span><span class="venue-sub">Flexible studios</span></div>
  </div>
</div>

<!-- VENUE QUOTE (original content preserved) -->
<div id="venuePage">
<div class="card">
  <div class="grid">
    <div class="full">
      <fieldset>
        <legend><strong>Booking Times & Event Day(s)</strong></legend>
        <div class="muted" style="margin-bottom:6px;">
          Please include your full booking time (get-in and get-out). Minimum 4-hour booking applies.<br>
          Regular hours: Mon–Fri 08:00–23:00, Sat–Sun 08:00–19:00.<br>
          After-hours surcharge: £20/hour + VAT applies outside these hours.
        </div>

        <div style="display:flex;gap:10px;margin-bottom:6px;">
          <div style="flex:1">
            <label for="startTime">Booking Start Time</label>
            <select id="startTime"></select>
          </div>
          <div style="flex:1">
            <label for="endTime">Booking End Time</label>
            <select id="endTime"></select>
          </div>
        </div>

        <div style="margin-bottom:6px;">
          <label><strong>Event Day(s)</strong></label>
          <div style="display:flex;flex-wrap:wrap;gap:10px;margin-top:4px;">
            <label><input type="checkbox" class="day" value="Mon"> Mon</label>
            <label><input type="checkbox" class="day" value="Tue"> Tue</label>
            <label><input type="checkbox" class="day" value="Wed"> Wed</label>
            <label><input type="checkbox" class="day" value="Thu"> Thu</label>
            <label><input type="checkbox" class="day" value="Fri"> Fri</label>
            <label><input type="checkbox" class="day" value="Sat"> Sat</label>
            <label><input type="checkbox" class="day" value="Sun"> Sun</label>
          </div>
        </div>
      </fieldset>
    </div>

    <div>
      <label for="venue">Venue / Space</label>
      <select id="venue">
        <option value="">— select venue —</option>
        <option value="Bradshaw">Bradshaw Hall</option>
        <option value="Recital">Recital Hall</option>
        <option value="Lab">The Lab</option>
        <option value="Jazz">Eastside Jazz Club</option>
        <option value="Organ">Organ Studio</option>
        <option value="WorkshopLarge">Workshop Space Large</option>
        <option value="WorkshopSmall">Workshop Space Small</option>
        <option value="DLHub">Distance Learning Hub</option>
        <option value="PracticeGrand2">Practice Room (2 grands)</option>
        <option value="PracticeGrand">Practice Room (grand)</option>
        <option value="PracticeUpright">Practice Room (upright)</option>
        <option value="Dressing">Additional Dressing Rooms</option>
      </select>
    </div>

    <div>
      <label for="hireType">Hire Type</label>
      <select id="hireType">
        <option value="standard">Standard Rate (includes FOH staff)</option>
        <option value="premium">Recording / Premium Workshop (dry hire)</option>
      </select>
    </div>

    <div class="full">
      <fieldset>
        <legend><strong>Technical / Equipment</strong></legend>
        <div class="muted" style="margin-bottom:6px;">Quantity</div>
        <div class="checkbox-row"><div>PA (per day)</div><div><input id="pa_qty" class="qty" type="number" min="0" value="0" /></div></div>
        <div class="checkbox-row"><div>Projector (per day)</div><div><input id="projector_qty" class="qty" type="number" min="0" value="0" /></div></div>
        <div class="checkbox-row"><div>Microphone (wired)</div><div><input id="mic_wired_qty" class="qty" type="number" min="0" value="0" /></div></div>
        <div class="checkbox-row"><div>Microphone (wireless)</div><div><input id="mic_wireless_qty" class="qty" type="number" min="0" value="0" /></div></div>
        <div class="checkbox-row"><div>Monitor</div><div><input id="monitor_qty" class="qty" type="number" min="0" value="0" /></div></div>
        <div class="checkbox-row"><div>Overhead audio recording</div><div><input id="overhead_qty" class="qty" type="number" min="0" value="0" /></div></div>
        <div class="checkbox-row"><div>Static video recording</div><div><input id="video_qty" class="qty" type="number" min="0" value="0" /></div></div>
        <div class="checkbox-row"><div>Laptop</div><div><input id="laptop_qty" class="qty" type="number" min="0" value="0" /></div></div>
        <div class="checkbox-row"><div>Grand Piano</div><div><input id="piano_qty" class="qty" type="number" min="0" value="0" /></div></div>
        <div class="muted" style="margin-top:6px;">Other instrument hire is available upon request, subject to availability.</div>
      </fieldset>
    </div>

    <div class="full" style="margin-top:10px;">
      <button id="addBtn">Add to Quote</button>
      <button id="emailBtn">Email Quote</button>
      <button id="downloadBtn">Download HTML</button>
    </div>
  </div>
</div>

<!-- Quote Summary -->
<div class="card">
  <h3 style="margin-top:0">Quote Summary</h3>
  <table id="orderTable">
    <thead>
      <tr>
        <th>Venue</th><th>Hire Type</th><th>Hours</th><th>Base (£)</th><th>Equipment (£)</th><th>Subtotal (£)</th><th>VAT (£)</th><th>Total (£)</th><th>After-Hours (£)</th><th>Remove</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="grandTotal">Grand Total: £0.00</div>
  <div class="muted" style="margin-top:6px;">Technician hours will be quoted separately based on the technical requirements of the event.</div>
  <div class="muted" style="margin-top:6px;">After-hours surcharge: £20/hour + VAT applies outside regular opening hours.</div>
  <div class="muted">For booking & detailed technical quotes contact: conservatoireevents@bcu.ac.uk</div>
  <div class="muted" style="margin-top:8px;"><strong>Disclaimer:</strong> Quote is for reference purposes only. All costs are subject to review.</div>
</div>
</div>

<!-- STAFF PAGE -->
<div id="staffPage" class="hidden">
  <div class="card">
    <h3 style="margin-top:0">Staffing Costs</h3>
    <div class="muted" style="margin-bottom:10px;">Password protected. Enter password when switching to this tab. VAT (20%) is added to the grand total.</div>
    <div class="grid" style="margin-bottom:10px;">
      <div class="full">
        <table id="staffTable">
          <thead>
            <tr>
              <th>Role</th>
              <th>Rate (£/hr)</th>
              <th>Quantity</th>
              <th>Hours</th>
              <th>Total (£)</th>
              <th>Remove</th>
            </tr>
          </thead>
          <tbody id="staffBody"></tbody>
        </table>
      </div>
      <div class="full" style="text-align:left;">
        <button id="addOtherBtn">Add "Other" Role</button>
      </div>
    </div>
    <div id="staffGrandTotal">Grand Total (incl. VAT): £0.00</div>
    <div class="muted" style="margin-top:6px;">Tip: set quantity and hours for each role to calculate total staffing cost (VAT included).</div>
  </div>
</div>

<!-- MODAL -->
<div class="modal" id="venueModal" aria-hidden="true">
  <div class="modal-content" role="dialog" aria-modal="true">
    <button class="modal-close" aria-label="Close modal">Close</button>
    <div class="modal-media">
      <button class="modal-prev" aria-label="Previous image">&#8249;</button>
      <button class="modal-next" aria-label="Next image">&#8250;</button>
      <img src="" alt="Venue image" id="modalImg">
      <div class="modal-hint">Click image to view next • or use arrows</div>
    </div>
    <div class="modal-desc" id="modalDesc"></div>
  </div>
</div>

<script>
/* =========================
   Navigation & Password
   ========================= */
const venuePage = document.getElementById('venuePage');
const staffPage = document.getElementById('staffPage');
const venueTab = document.getElementById('venueTab');
const staffTab = document.getElementById('staffTab');
const clearSession = document.getElementById('clearSession');
const STAFF_PASSWORD = 'rbcstaffcosts';

venueTab.onclick = () => {
  venuePage.classList.remove('hidden');
  staffPage.classList.add('hidden');
};
staffTab.onclick = () => {
  if (sessionStorage.getItem('staffAccess') === STAFF_PASSWORD) {
    venuePage.classList.add('hidden');
    staffPage.classList.remove('hidden');
    clearSession.style.display = 'inline-block';
    return;
  }
  const pass = prompt('Enter password to access staffing calculator:');
  if (pass === STAFF_PASSWORD) {
    sessionStorage.setItem('staffAccess', STAFF_PASSWORD);
    venuePage.classList.add('hidden');
    staffPage.classList.remove('hidden');
    clearSession.style.display = 'inline-block';
  } else {
    alert('Incorrect password.');
  }
};
clearSession.onclick = (e) => {
  e.preventDefault();
  sessionStorage.removeItem('staffAccess');
  clearSession.style.display = 'none';
  venuePage.classList.remove('hidden');
  staffPage.classList.add('hidden');
  alert('Staffing access cleared.');
};

/* =========================
   Venue data (your exact descriptions + images)
   ========================= */
const venueData = {
  Bradshaw:{desc:"The Bradshaw Hall has been acoustically modelled to optimise the experience of performers and to ensure the best auditory experience from every seat. From the soft pallets of the colour scheme to state-of-the-art performance lighting and technical capabilities, each aspect of the hall has been expertly designed to provide an inspiring backdrop for the performances and other activity being presented there. The hall has a raised platform stage with three retractable risers and a stage extension, large enough for a full symphony orchestra. Audience seating graduates across a gentle rake with further seating provided on a small balcony above the back section of the 440 capacity hall. The hall is serviced by an extensive back-of house area with soloist and green rooms and access to our spacious atrium and foyer, and our range of performance studios and function rooms when the hall is booked as part of a larger event.", images:["https://www.tagvenue.com/resize/98/a1/widen-1680-noupsize;68138-bradshaw-hall-room-enhanced-v1-3027435.jpg","http://www.bcu.ac.uk/mediaitem/royal-birmingham-conservatoire-symphony-orchestra-and-chorus-131855489657224296.jpg?quality=90","https://bcuassets.blob.core.windows.net/img/the-bradshaw-hall-131735296676445133.jpg","https://cphfcrflaa.cloudimg.io/_bcuimages/04-07-2024-folk-ensemble-web-133765767100637752.jpg"]},
  Recital:{desc:"The intimate Recital Hall has a variable acoustic and is a flexible space with a floor-level stage area. A bleacher seating rake of 146 capacity can be extended for concert set-up, or fully retracted underneath a small technical balcony for other seating and event set-ups including cabaret and theatre style. As with our larger Bradshaw Hall, attention has been paid to every detail in the design of the hall to optimise the experience of both audiences and performers – from the acoustics to the colour scheme of the interior fit-out and from performance lighting to technical capabilities.", images:["https://azure.wgp-cdn.co.uk/app-pianist/posts/Royal-Birmingham-Conservatoire_Charcoalblue_credit-Hufton-and-Crow_lowres-023.jpg?&width=1200&height=630&mode=crop","https://www.association-of-noise-consultants.co.uk/wp-content/uploads/2018/08/RBC-Recital-Hall-Steinway-Piano-min.jpg","https://www.bof.co.uk/assets/images/projects/royal-birmingham-conservatoire/small-4.png"]},
  Jazz:{desc:"Birmingham’s only dedicated Jazz venue, Eastside Jazz Club has been expertly designed to create a quintessential, cosy, jazz club atmosphere. Your guests can relax in style with low – level mood lighting and cabaret setting creating the perfect ambience for an authentic, sophisticated laid-back jazz bar. This is a fully flexible performance space with removable audience seating, tables and bar-stools running across three raised levels to be arranged as required. Choose from a private setting with blackout blinds or open to allow natural light in as desired. While predominantly for the performance of jazz music in all its forms, the venue is also an ideal setting for other types of small music gig as well as spoken word and comedy.", images:["https://img.bcu.ac.uk/_bcuimages/tom-bird-birmingham-conservatoire-25-131600600782377259.jpg", "https://tse1.mm.bing.net/th/id/OIP.rQ4jKYUx7O_SLtJNosUp0wHaCx?pid=Api","https://tse1.mm.bing.net/th/id/OIP.cmNowyLdhr5FQ-WSsRMvaAHaF-?pid=Api"]},
  Organ:{desc:"A light and airy venue that is equally suited to chamber and organ performance. The venue has a distinctive shape and tranquil atmosphere created by natural light flooding onto the pale wood of the interior. It is completely flexible in terms of the set-up and layout of the performance area and audience seating. The venue houses a Eule Pipe organ and features overhead performance lighting and Dante audio network for flexible location recording purposes. With access to Steinway model D or model B grand pianos, there is also a wide range of other instruments and equipment available for hire.", images:["https://img.bcu.ac.uk/_bcuimages/copyright-hufton-crow-30-131600603623200315.jpg","https://tse4.mm.bing.net/th/id/OIP.ZqMlPPtq9HssFc17TJUyIAHaE8?pid=Api","https://tse1.mm.bing.net/th/id/OIP.Sc1WQGk9lCcNOehBIAWehwHaFj?pid=Api"]},
  Lab:{desc:"The Lab is a cutting edge, completely flexible black-box studio with a technical walkway suspended around the perimeter. The 100 capacity venue has fixed acoustics with a low reverberation time and duplicate input points for a mobile sound desk to be installed at either end of the room. This enables complete flexibility in the set-up and layout of the performance and audience areas.", images:["https://img.bcu.ac.uk/_bcuimages/tom-bird-birmingham-conservatoire-8-131600601961613750.jpg","https://tse3.mm.bing.net/th/id/OIP.KVLOD-33YQ_4lm-3T7IqewHaE8?pid=Api","https://tse3.mm.bing.net/th/id/OIP.y1fzC3dK3PyZjZh6JcXCjAHaE8?pid=Api"]},
  Workshop:{desc:"Eight 30-60 capacity performance studios sit at the heart of the Conservatoire that have been designed to the highest artistic and commercial standards for the professional training of our musicians and actors. High ceilings, large windows and spacious open floor areas enable flexible spaces that are equally suited for the development of performance activity, as they are in providing a refined backdrop for conferences and meetings, or as the starting point to be dressed for functions and receptions. Each studio has a timber hardwood floor, grand piano, B&W surround sound or stereo system, laser projector and screen with wireless presentation connectivity", images:["https://img.bcu.ac.uk/_bcuimages/copyright-hufton-crow-2-131600605710728764.jpg","https://img.bcu.ac.uk/_bcuimages/natalie-haas-cello-workshop-133970508075817499.jpg"] }
};

/* ============= Gallery modal behavior ============= */
const panels = document.querySelectorAll(".panel");
const modal = document.getElementById("venueModal");
const modalImg = document.getElementById("modalImg");
const modalDesc = document.getElementById("modalDesc");
const btnClose = document.querySelector(".modal-close");
const btnPrev = document.querySelector(".modal-prev");
const btnNext = document.querySelector(".modal-next");
let currentImages = [], currentIndex = 0;

function openVenue(venKey){
  const v = venueData[venKey];
  if(!v) return;
  currentImages = v.images.slice(); // copy
  currentIndex = 0;
  modalImg.src = currentImages[currentIndex];
  modalDesc.textContent = v.desc;
  modal.style.display = 'flex';
  modal.setAttribute('aria-hidden','false');
  // focus for accessibility
  setTimeout(()=>btnClose.focus(),150);
}

panels.forEach(p=>{
  p.addEventListener('click', ()=> openVenue(p.dataset.venue));
});

// close handlers
btnClose.addEventListener('click', ()=>{ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); });
modal.addEventListener('click', (e)=>{ if(e.target === modal) { modal.style.display='none'; modal.setAttribute('aria-hidden','true'); } });

// arrow handlers
btnPrev.addEventListener('click', (e)=>{ e.stopPropagation(); if(!currentImages.length) return; currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length; modalImg.src = currentImages[currentIndex]; });
btnNext.addEventListener('click', (e)=>{ e.stopPropagation(); if(!currentImages.length) return; currentIndex = (currentIndex + 1) % currentImages.length; modalImg.src = currentImages[currentIndex]; });

// click image to cycle
modalImg.addEventListener('click', (e)=>{
  if(!currentImages.length) return;
  currentIndex = (currentIndex + 1) % currentImages.length;
  modalImg.src = currentImages[currentIndex];
});

// keyboard navigation (Esc, left/right)
document.addEventListener('keydown', (e)=>{
  if(modal.style.display !== 'flex') return;
  if(e.key === 'Escape'){ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); }
  if(e.key === 'ArrowLeft'){ currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length; modalImg.src = currentImages[currentIndex]; }
  if(e.key === 'ArrowRight'){ currentIndex = (currentIndex + 1) % currentImages.length; modalImg.src = currentImages[currentIndex]; }
});

/* =========================
   Fill time selects & helper fns
   ========================= */
const startTime = document.getElementById('startTime'), endTime=document.getElementById('endTime');
for(let h=0; h<24; h++){
  for(let m=0; m<60; m+=30){
    const val = (h<10?'0':'')+h+':'+(m<10?'0':'')+m;
    const o1 = document.createElement('option'); o1.value=val; o1.textContent=val; startTime.appendChild(o1);
    const o2 = document.createElement('option'); o2.value=val; o2.textContent=val; endTime.appendChild(o2);
  }
}
startTime.value='09:00'; endTime.value='13:00';

function timeToHours(t){ const [h,m]=t.split(':').map(Number); return h + m/60; }
function getBookingHours(){ let diff = timeToHours(endTime.value) - timeToHours(startTime.value); if(diff < 0) diff += 24; return Math.max(diff,4); }

/* =========================
   Quote Calculator (original logic preserved + after-hours)
   ========================= */
const rates = {
  Bradshaw:{standard:250,premium:125},Recital:{standard:200,premium:100},Lab:{standard:175,premium:87.5},
  Jazz:{standard:175,premium:87.5},Organ:{standard:150,premium:75},WorkshopLarge:{standard:60,premium:60},
  WorkshopSmall:{standard:50,premium:50},DLHub:{standard:35,premium:35},PracticeGrand2:{standard:40,premium:40},
  PracticeGrand:{standard:30,premium:30},PracticeUpright:{standard:25,premium:25},Dressing:{standard:25,premium:25}
};
const PIANO_RATE = 100;
const EQUIPMENT_RATES = { pa:100, projector:250, micWired:20, micWireless:40, monitor:15, overhead:100, video:250, laptop:50, piano:PIANO_RATE };
const order = [];

const formatGBP = n => '£' + n.toFixed(2);

function calcCosts(rate,h,e){
  const base = rate * h;
  const addons = Object.keys(e).reduce((sum,key)=> sum + (e[key]||0) * (EQUIPMENT_RATES[key]||0), 0);
  const sub = base + addons;
  const vat = sub * 0.2;
  const total = sub + vat;
  return { base, addons, subtotal: sub, vat, total };
}

function calcAfterHoursPerBooking(){
  const days = [...document.querySelectorAll('.day:checked')].map(d=>d.value);
  if(days.length === 0) return 0;
  const s = timeToHours(startTime.value);
  const e = timeToHours(endTime.value);
  let surcharge = 0;
  days.forEach(d=>{
    const open = 8;
    const close = (d === 'Sat' || d === 'Sun') ? 19 : 23;
    if(s < open) surcharge += Math.max(0, open - s) * 20;
    if(e > close) surcharge += Math.max(0, e - close) * 20;
  });
  return surcharge * 1.2;
}

function updateTable(){
  const tb = document.querySelector('#orderTable tbody'); tb.innerHTML = '';
  let grand = 0;
  order.forEach((it,i)=>{
    const r = document.createElement('tr');
    r.innerHTML = `
      <td>${it.venue}</td>
      <td>${it.hireType}</td>
      <td>${it.hours}</td>
      <td>${formatGBP(it.costs.base)}</td>
      <td>${formatGBP(it.costs.addons)}</td>
      <td>${formatGBP(it.costs.subtotal)}</td>
      <td>${formatGBP(it.costs.vat)}</td>
      <td>${formatGBP(it.costs.total)}</td>
      <td>${formatGBP(it.afterHours)}</td>
      <td><button onclick="removeItem(${i})">Remove</button></td>
    `;
    tb.appendChild(r);
    grand += it.costs.total + it.afterHours;
  });
  document.getElementById('grandTotal').textContent = 'Grand Total: ' + formatGBP(grand);
}

window.removeItem = i => { order.splice(i,1); updateTable(); };

document.getElementById('addBtn').addEventListener('click', ()=>{
  const v = document.getElementById('venue').value;
  if(!v){ alert('Please select a venue'); return; }
  const hType = document.getElementById('hireType').value;
  const hours = getBookingHours();
  const days = [...document.querySelectorAll('.day:checked')].map(d=>d.value);
  if(days.length === 0){ alert('Please select at least one day'); return; }

  const eq = {
    pa: +document.getElementById('pa_qty').value,
    projector: +document.getElementById('projector_qty').value,
    micWired: +document.getElementById('mic_wired_qty').value,
    micWireless: +document.getElementById('mic_wireless_qty').value,
    monitor: +document.getElementById('monitor_qty').value,
    overhead: +document.getElementById('overhead_qty').value,
    video: +document.getElementById('video_qty').value,
    laptop: +document.getElementById('laptop_qty').value,
    piano: +document.getElementById('piano_qty').value
  };

  const rate = rates[v] ? rates[v][hType] : 0;
  const costs = calcCosts(rate, hours, eq);
  const afterHours = calcAfterHoursPerBooking();

  order.push({ venue: v, hireType: hType, hours, costs, afterHours });
  updateTable();
});

/* Email & Download functionality */
document.getElementById('emailBtn').addEventListener('click', ()=>{
  if(order.length === 0) return alert('Add at least one venue first.');
  let body = order.map((it,i)=>`Item ${i+1}: ${it.venue} (${it.hireType}) ${it.hours}h | Base ${formatGBP(it.costs.base)} | Equip ${formatGBP(it.costs.addons)} | Total ${formatGBP(it.costs.total)} | After-Hours ${formatGBP(it.afterHours)}`).join('\n');
  const grand = order.reduce((a,b)=>a + b.costs.total + b.afterHours, 0);
  body += `\n\nGrand Total: ${formatGBP(grand)}\n\nTechnician hours quoted separately.`;
  location.href = `mailto:conservatoireevents@bcu.ac.uk?subject=${encodeURIComponent('RBC Event Quote')}&body=${encodeURIComponent(body)}`;
});

document.getElementById('downloadBtn').addEventListener('click', ()=>{
  if(order.length === 0) return alert('Add at least one venue first.');
  let html = `<html><head><title>Quote</title></head><body><h1>Quote Summary</h1><table border="1" cellpadding="5"><tr><th>Venue</th><th>Hire Type</th><th>Hours</th><th>Base (£)</th><th>Equipment (£)</th><th>Subtotal (£)</th><th>VAT (£)</th><th>Total (£)</th><th>After-Hours (£)</th></tr>`;
  let grand = 0;
  order.forEach(it=>{
    html += `<tr><td>${it.venue}</td><td>${it.hireType}</td><td>${it.hours}</td><td>${formatGBP(it.costs.base)}</td><td>${formatGBP(it.costs.addons)}</td><td>${formatGBP(it.costs.subtotal)}</td><td>${formatGBP(it.costs.vat)}</td><td>${formatGBP(it.costs.total)}</td><td>${formatGBP(it.afterHours)}</td></tr>`;
    grand += it.costs.total + it.afterHours;
  });
  html += `<tr><td colspan="8" style="text-align:right"><strong>Grand Total</strong></td><td><strong>${formatGBP(grand)}</strong></td></tr></table></body></html>`;
  const blob = new Blob([html], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'quote.html'; a.click(); URL.revokeObjectURL(url);
});

/* =========================
   Staffing costs
   ========================= */
const staffBody = document.getElementById('staffBody');
const staffGrandTotal = document.getElementById('staffGrandTotal');
document.getElementById('addOtherBtn').addEventListener('click', ()=> addStaffRow());

function addStaffRow(role='Other', rate=0, qty=1, hrs=1){
  const tr = document.createElement('tr');
  tr.innerHTML = `<td><input type="text" value="${role}" /></td>
    <td><input type="number" value="${rate}" min="0" /></td>
    <td><input type="number" value="${qty}" min="0" /></td>
    <td><input type="number" value="${hrs}" min="0" /></td>
    <td class="total">£0.00</td>
    <td><button class="rmBtn">Remove</button></td>`;
  staffBody.appendChild(tr);
  tr.querySelectorAll('input').forEach(i=> i.addEventListener('input', updateStaffTotal));
  tr.querySelector('.rmBtn').addEventListener('click', ()=>{ tr.remove(); updateStaffTotal(); });
  updateStaffTotal();
}

// default roles
[{name:"Duty Manager",rate:32},{name:"Steward",rate:22},{name:"Porter",rate:20},{name:"Security",rate:20},{name:"Technician",rate:35}].forEach(r=> addStaffRow(r.name,r.rate,1,1));

function updateStaffTotal(){
  let sum = 0;
  staffBody.querySelectorAll('tr').forEach(tr=>{
    const rate = parseFloat(tr.children[1].children[0].value) || 0;
    const qty = parseFloat(tr.children[2].children[0].value) || 0;
    const hrs = parseFloat(tr.children[3].children[0].value) || 0;
    const tot = rate * qty * hrs;
    tr.children[4].textContent = '£' + tot.toFixed(2);
    sum += tot;
  });
  const vat = sum * 0.2;
  staffGrandTotal.textContent = `Grand Total (incl. VAT): £${(sum + vat).toFixed(2)}  —  (VAT ${formatGBP(vat)})`;
}

/* initialize staff totals */
updateStaffTotal();
</script>

</div>
</body>
</html>
