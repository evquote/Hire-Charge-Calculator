<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Venue Booking Quote Calculator</title>
<style>
  body { font-family: Arial, sans-serif; margin: 40px; background: #f7f7f7; color: #333; }
  h1 { text-align: center; margin-bottom: 20px; }
  form { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
  label { display: block; margin-top: 10px; font-weight: bold; }
  select, input { width: 200px; padding: 5px; margin-top: 5px; }
  button { background: #007bff; color: #fff; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; margin-top: 15px; }
  button:hover { background: #0056b3; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background: #007bff; color: #fff; }
  .totals { margin-top: 20px; background: #fff; padding: 15px; border-radius: 10px; }
  .after-hours { color: #d9534f; font-weight: bold; }
  .note { font-size: 0.9em; color: #666; margin-top: 3px; }
</style>
</head>
<body>

<h1>Venue Booking Quote Calculator</h1>

<form id="quoteForm">

  <!-- Booking times at the top -->
  <label>Booking Start Time</label>
  <select id="startTime"></select>

  <label>Booking End Time</label>
  <select id="endTime"></select>
  <p class="note">Bookings must start after 7:00 AM and be at least 4 hours long.</p>

  <label>Venue</label>
  <select id="venue">
    <option value="Main Hall">Main Hall</option>
    <option value="Conference Room">Conference Room</option>
    <option value="Outdoor Space">Outdoor Space</option>
  </select>

  <label>Hire Type</label>
  <select id="hireType">
    <option value="Standard">Standard</option>
    <option value="Premium">Premium</option>
  </select>

  <label>Equipment Add-ons (£)</label>
  <input type="number" id="addons" value="0" min="0" step="1">

  <button type="button" id="addItem">Add to Quote</button>
</form>

<table id="orderTable">
  <thead>
    <tr>
      <th>Venue</th>
      <th>Hire Type</th>
      <th>Hours</th>
      <th>Base (£)</th>
      <th>Equipment (£)</th>
      <th>After-Hours (£)</th>
      <th>Subtotal (£)</th>
      <th>VAT (£)</th>
      <th>Total (£)</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="totals">
  <h3>Grand Total: <span id="grandTotal">£0.00</span></h3>
</div>

<!-- Email & Download buttons -->
<button type="button" id="emailQuote">Email Quote</button>
<button type="button" id="downloadQuote">Download Quote</button>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const startSelect = document.getElementById('startTime');
  const endSelect = document.getElementById('endTime');
  const order = [];

  // Populate time dropdowns (07:00–23:30)
  function populateTimeDropdowns() {
    for (let h = 7; h < 24; h++) {
      for (let m = 0; m < 60; m += 30) {
        const val = ('0' + h).slice(-2) + ':' + ('0' + m).slice(-2);
        const opt1 = document.createElement('option');
        const opt2 = document.createElement('option');
        opt1.value = opt2.value = val;
        opt1.textContent = opt2.textContent = val;
        startSelect.appendChild(opt1);
        endSelect.appendChild(opt2);
      }
    }
    startSelect.value = '09:00';
    endSelect.value = '13:00';
  }

  populateTimeDropdowns();

  // Calculate duration in hours
  function calculateHours() {
    const [sh, sm] = startSelect.value.split(':').map(Number);
    const [eh, em] = endSelect.value.split(':').map(Number);
    const start = sh + sm / 60;
    const end = eh + em / 60;
    return end - start;
  }

  // Enforce 4-hour minimum
  function validateBookingTimes() {
    const hours = calculateHours();
    const [sh] = startSelect.value.split(':').map(Number);
    if (sh < 7) {
      alert('Bookings cannot start before 07:00.');
      startSelect.value = '07:00';
    }
    if (hours < 4) {
      alert('Minimum booking duration is 4 hours.');
      const newEndIndex = startSelect.selectedIndex + 8; // 4 hours later (8 x 30min)
      endSelect.selectedIndex = newEndIndex < endSelect.options.length ? newEndIndex : endSelect.options.length - 1;
    }
  }

  startSelect.addEventListener('change', validateBookingTimes);
  endSelect.addEventListener('change', validateBookingTimes);

  const baseRates = {
    'Main Hall': { Standard: 100, Premium: 150 },
    'Conference Room': { Standard: 80, Premium: 120 },
    'Outdoor Space': { Standard: 60, Premium: 90 }
  };

  document.getElementById('addItem').addEventListener('click', () => {
    const venue = document.getElementById('venue').value;
    const hireType = document.getElementById('hireType').value;
    const addons = parseFloat(document.getElementById('addons').value) || 0;
    const hours = calculateHours();

    if (hours < 4) {
      alert('Minimum booking duration is 4 hours.');
      return;
    }

    const baseRate = baseRates[venue][hireType];
    const base = baseRate * hours;

    // After-hours surcharge (after 23:00)
    const [eh] = endSelect.value.split(':').map(Number);
    const afterHours = eh > 23 ? (eh - 23) * 25 : 0;

    const subtotal = base + addons + afterHours;
    const vat = subtotal * 0.2;
    const total = subtotal + vat;

    order.push({ venue, hireType, hours, base, addons, afterHours, subtotal, vat, total });
    updateTable();
  });

  function updateTable() {
    const tbody = document.querySelector('#orderTable tbody');
    tbody.innerHTML = '';
    order.forEach((item, i) => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${item.venue}</td>
        <td>${item.hireType}</td>
        <td>${item.hours.toFixed(1)}</td>
        <td>£${item.base.toFixed(2)}</td>
        <td>£${item.addons.toFixed(2)}</td>
        <td>£${item.afterHours.toFixed(2)}</td>
        <td>£${item.subtotal.toFixed(2)}</td>
        <td>£${item.vat.toFixed(2)}</td>
        <td>£${item.total.toFixed(2)}</td>
        <td><button onclick="removeItem(${i})">Remove</button></td>
      `;
      tbody.appendChild(row);
    });
    updateTotals();
  }

  window.removeItem = (index) => {
    order.splice(index, 1);
    updateTable();
  };

  function updateTotals() {
    const grandTotal = order.reduce((sum, i) => sum + i.total, 0);
    document.getElementById('grandTotal').textContent = `£${grandTotal.toFixed(2)}`;
  }

  // --- Email and download functionality ---
  document.getElementById('emailQuote').addEventListener('click', () => {
    const summary = order.map(i => 
      `${i.venue} (${i.hireType}) - ${i.hours}h - Total: £${i.total.toFixed(2)}`
    ).join('\n');
    const mailto = `mailto:?subject=Booking Quote&body=${encodeURIComponent(summary + '\nGrand Total: ' + document.getElementById('grandTotal').textContent)}`;
    window.location.href = mailto;
  });

  document.getElementById('downloadQuote').addEventListener('click', () => {
    const html = `
      <html><body>
      <h2>Venue Booking Quote</h2>
      <table border="1" style="border-collapse:collapse;width:100%;">
      <tr><th>Venue</th><th>Hire Type</th><th>Hours</th><th>Base (£)</th><th>Equipment (£)</th><th>After-Hours (£)</th><th>Subtotal (£)</th><th>VAT (£)</th><th>Total (£)</th></tr>
      ${order.map(i => `
        <tr>
          <td>${i.venue}</td><td>${i.hireType}</td><td>${i.hours}</td>
          <td>£${i.base.toFixed(2)}</td><td>£${i.addons.toFixed(2)}</td><td>£${i.afterHours.toFixed(2)}</td>
          <td>£${i.subtotal.toFixed(2)}</td><td>£${i.vat.toFixed(2)}</td><td>£${i.total.toFixed(2)}</td>
        </tr>`).join('')}
      <tr><td colspan="8" style="text-align:right"><strong>Grand Total</strong></td><td><strong>${document.getElementById('grandTotal').textContent}</strong></td></tr>
      </table></body></html>
    `;
    const blob = new Blob([html], {type: 'text/html'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'quote.html';
    a.click();
    URL.revokeObjectURL(url);
  });

});
</script>

</body>
</html>
